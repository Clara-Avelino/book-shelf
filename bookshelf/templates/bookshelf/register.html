{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Criar Conta | Book Shelf</title>
    <link rel="stylesheet" href="{% static 'css/login.css' %}">
</head>
<body>

<div class="login-page">

    <div class="login-left">
        <img src="{% static 'images/LogoLivraria.png' %}" class="illustration">
        <h1>Book Shelf</h1>
        <h3>Sua biblioteca digital pessoal</h3>
        <p>Organize, gerencie e acesse seus livros de qualquer lugar</p>
    </div>

    <div class="login-right">
        <div class="login-card register-card">

            <div class="card-logo">
                <img src="{% static 'images/LogoLivraria.png' %}">
                <strong>Book Shelf</strong>
                <span>Sua biblioteca digital</span>
            </div>

            <p class="card-subtitle">Acesse sua conta ou crie uma nova</p>

            <div class="tabs">
                <a href="{% url 'login' %}" class="tab">Entrar</a>
                <a href="{% url 'register' %}" class="tab active">Cadastrar</a>
            </div>

            <form method="post" id="registerForm">
                {% csrf_token %}

                <label>Nome</label>
                <input type="text" id="first_name" placeholder="Seu nome">

                <label>Sobrenome</label>
                <input type="text" id="last_name" placeholder="Seu sobrenome">

                <label>Username</label>
                <input type="text" id="username" placeholder="Seu nome de usuário">

                <label>E-mail</label>
                <input type="email" id="email" placeholder="seu@email.com">

                <label>Senha</label>
                <input type="password" id="password"  placeholder="Mínimo 6 caracteres">

                <label>Confirmar Senha</label>
                <input type="password" id="password2"placeholder="Digite a senha novamente">

                <button class="btn-login">Criar Conta</button>
            </form>

            <div class="divider"><span>ou</span></div>

            <button class="btn-google">
                <span class="google-icon">G</span>
                Cadastrar com Google
            </button>

        </div>
    </div>
</div>
<script>document.getElementById("registerForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const username = document.getElementById("username").value;
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const password2 = document.getElementById("password2").value;
  const first_name = document.getElementById("first_name").value;
  const last_name = document.getElementById("last_name").value;

  if (password !== password2) {
    alert("As senhas não coincidem!");
    return;
  }

  const body = {
    username: username.value,
    email: email.value,
    password: password.value,
    first_name: first_name.value,
    last_name: last_name.value
  };
  try {
    const response = await fetch("https://usuarioapi-production.up.railway.app/api/registro", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(body)
  });

  if(response.ok){
    alert("Cadastro realizado com sucesso!");
    window.location.href = "/login/";
  } else {
    const error = await response.json();
    alert("Erro ao cadastrar");
  }
} catch (err){
    alert("Erro de conexão com a API");
}
});
  
</script>
</body>
</html>
